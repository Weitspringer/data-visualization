<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Exercise 1.3 - Scatter plot</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <body>
    <svg id="canvas" width="1000" height="1000"></svg>
  </body>
  <script>
    // Margins
    var margin = { top: 50, right: 50, bottom: 50, left: 100 },
      width = 900 - margin.left - margin.right,
      height = 600 - margin.top - margin.bottom;

    // Colormap for continents
    var continent_colormap = {
      Europe: "#FFCA3A",
      Oceania: "#6CCFF6",
      Africa: "#D74E09",
      "North America": "#8AC926",
      "South America": "#C113F6",
      Asia: "#0A2342",
    };

    var svg = d3
      .select("#canvas")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Read csv file, filter data and create categorized plot
    d3.csv("/data/UnRegionsGdp.csv").then(function (data) {
      filtered_data = data.filter(function (d, i) {
        if (d["HDI_2017"] > 0 && d["GDP_2017"] > 0) {
          return d;
        }
      });
      // Linear scale x axis for HDI
      var x = d3
        .scaleLinear()
        .domain([0, d3.max(filtered_data, (d) => Math.max(d.HDI_2017))])
        .range([0, width]);
      svg
        .append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      // Logarithmic scale y axis for GDP
      var y = d3
        .scaleLog()
        .domain([
          d3.min(filtered_data, (d) => Math.max(d.GDP_2017)),
          d3.max(filtered_data, (d) => Math.max(d.GDP_2017)),
        ])
        .range([height, 1]);
      svg.append("g").call(d3.axisLeft(y));

      // Append the axis labels
      svg
        .append("text")
        .attr("x", width / 2)
        .attr("y", height + margin.bottom)
        .style("text-anchor", "middle")
        .text("Human Development Index (HDI)")
        .style("font-family", "sans-serif");

      svg
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - 45)
        .attr("x", 0 - height / 2)
        .style("text-anchor", "middle")
        .text("Annual GDP per capita (USD)")
        .style("font-family", "sans-serif");

      // Add data points
      svg
        .append("g")
        .selectAll("dot")
        .data(filtered_data)
        .enter()
        .append("circle")
        .attr("cx", function (d) {
          return x(d.HDI_2017);
        })
        .attr("cy", function (d) {
          return y(d.GDP_2017);
        })
        .attr("r", 2.5)
        .style("fill", function (d) {
          return continent_colormap[d.Continent];
        });
    });

    var legend = d3
      .select("#canvas")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Usually you have a color scale in your chart already
    var color = d3
      .scaleOrdinal()
      .domain(Object.keys(continent_colormap))
      .range(d3.schemeSet1);

    // Add one rectangle in the legend for each continent
    var legend_bar_height = 20;
    var legend_bar_width = 60;
    legend
      .selectAll("rect")
      .data(Object.keys(continent_colormap))
      .enter()
      .append("rect")
      .attr("x", legend_bar_width)
      .attr("y", function (d, i) {
        return 0 + i * (legend_bar_height + 5);
      })
      .attr("width", legend_bar_width)
      .attr("height", legend_bar_height)
      .style("fill", function (d) {
        return continent_colormap[d];
      });

    // Add one dot in the legend for each continent.
    legend
      .selectAll("labels")
      .data(Object.keys(continent_colormap))
      .enter()
      .append("text")
      .attr("x", legend_bar_width * 2.2)
      .attr("y", function (d, i) {
        return 0 + i * (legend_bar_height + 5) + legend_bar_height / 2 + 5;
      })
      .style("fill", function (d) {
        return continent_colormap[d];
      })
      .style("font-family", "sans-serif")
      .text(function (d) {
        return d;
      })
      .attr("text-anchor", "left")
      .style("alignment-baseline", "middle");
  </script>
</html>
