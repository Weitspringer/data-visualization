<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Covid-19 Dataset</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      text {
        font-family: "Yanone Kaffeesatz", sans-serif;
        font-size: 7pt;
      }
    </style>
  </head>
  <body>
    <svg width="100%" height="100%" viewBox="0 0 1200 600"></svg>
  </body>
  <script>
    function hashCode(s) {
      let h = 0;
      for (let i = 0; i < s.length; i++)
        h = (Math.imul(31, h) + s.charCodeAt(i)) | 0;
      return h;
    }

    covid_data = {
      keys : {},
      subgroups : {},
      data: {},
    }

    d3.csv("/exercise_2_3/data/owid-covid-data.csv", function (row) {
      return {
        key: row.iso_code,
        key_hash: hashCode(row.iso_code),
        location: row.location,
        total_cases: row.total_cases,
      };
    }).then(function (d) {
      covid_data.data = d;
      covid_data.subgroups = d.columns.slice(1);
      covid_data.keys = d3
        .map(d, function (d) {
          return d.key;
        })
        .keys().sort(function (a, b) { return d3.ascending(a,b)});
      console.log(covid_data)
      draw();
    });

    // Retrieve data for an iso_code
    function getData(key) {
      return covid_data.data.filter(entry => entry.key === key)
    }

    // Retrieve array containing course of total cases
    function getTotalCases(key) {
      return getData(key).map(entry => entry.total_cases);
    }

    function draw() {
      var margin = { top: 20, right: 10, bottom: 10, left: 15, circle: 20 },
      w = 240 - margin.left - margin.right,
      h = 160 - margin.top - margin.bottom;
    }
  </script>
</html>
